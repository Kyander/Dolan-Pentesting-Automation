#!/usr/bin/python3
import requests
import os
import argparse
import subprocess
import sys

class SubdomainFuzzer():
    def __init__(self, url, wordlist, rp, responseMode):

        self.check_ffuf()
        self.responseMode = responseMode
        if self.responseMode == True:
            self.response_codes = rp
        else:
            pass
        self.url = url
        self.wordlist = wordlist
        self.host = self.url.split("//")[1]
        self.filter_size = self.get_size()
        self.run_ffuf()

    def check_ffuf(self):
        result = subprocess.run(['which', 'ffuf'], stdout=subprocess.PIPE)
        out = result.stdout.decode("utf-8")
        if out == "":
            print("[!] You need ffuf in order to run this script...")
            sys.exit()
        else:
            pass
        return out.strip()


    def get_size(self):
        r = requests.get(self.url)
        return str(len(r.text))

    def run_ffuf(self):
        if self.responseMode == True:
            command = "ffuf -c -w {} -H 'Host: FUZZ.{}' -mc {} -u {}".format(self.wordlist ,self.host, self.response_codes, self.url)
        else:
            command = "ffuf -c -w {} -fs {} -H 'Host: FUZZ.{}' -u {}".format(self.wordlist, self.filter_size, self.host, self.url)
        print("[!] Command : {}".format(command))
        os.system(command)

if __name__ == "__main__":
    print("""
    ----------------------------------------------------------------------
        ____        __               ____      ____     _____            
       / __ \____  / /___ _____     /  _/___  / __/___ / ___/___  _____
      / / / / __ \/ / __ `/ __ \    / // __ \/ /_/ __ \\\__ \/ _ \/ ___/
     / /_/ / /_/ / / /_/ / / / /  _/ // / / / __/ /_/ /__/ /  __/ /__  
    /_____/\____/_/\__,_/_/ /_/  /___/_/ /_/_/  \____/____/\___/\___/  


            SubDomain Fuzzer
            Made By : Kyand
    -----------------------------------------------------------------------
        """)

    parser = argparse.ArgumentParser(description="SubDomain Fuzzer")
    parser.add_argument('-w', '--wordlist', type=str, metavar='wordlist.txt', required=True,
                        help='Subdoamin wordlist')
    parser.add_argument('-u', '--url', type=str, metavar='http://localhost.com', required=True,
                        help='URL to fuzz')
    _ = parser.add_argument('-rc', '--responseMode', action='store_true')
    parser.add_argument('-fc', '--responsecodes', type=str, metavar='200,204,301,307,401,403,405', required=False, help='custom response codes to filter')
    args = parser.parse_args()

    if args.responseMode:
        responseMode = True
    else:
        responseMode = False

    fuzzer = SubdomainFuzzer(args.url, args.wordlist, args.responsecodes, responseMode)
