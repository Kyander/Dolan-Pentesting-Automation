import os
import random
import string


class SmbServer:
    def __init__(self):
        print("[!] You need impacket's smbserver.py in your PATH.\n")
        self.length = 14  # Define password length
        self.password = self.gen_password()
        self.start_server()

    def gen_password(self):
        password = ''.join(random.choice(string.ascii_letters) for i in range(self.length))
        return password

    def start_server(self):
        command = "smbserver.py Dolan $(pwd) -smb2support -user D0laNnn -password {}".format(self.password)
        print("[!]Starting SMB server with command :\n{}\n\nYou can connect to it by running these commands in powershell :\n  1. $pass = convertto-securestring '{}' -AsPlainText -Force\n  2. $cred = New-Object System.Management.Automation.PSCredential('D0laNnn', $pass)".format(command, self.password))
        print(r"  3. New-PSDrive -Name Dolan -PSProvider FileSystem -Credential $cred -Root \\YourIP\Dolan")
        print("\n")
        os.system(command)


if __name__ == "__main__":
    print("""
    ----------------------------------------------------------------------
        ____        __               ____      ____     _____            
       / __ \____  / /___ _____     /  _/___  / __/___ / ___/___  _____
      / / / / __ \/ / __ `/ __ \    / // __ \/ /_/ __ \\\__ \/ _ \/ ___/
     / /_/ / /_/ / / /_/ / / / /  _/ // / / / __/ /_/ /__/ /  __/ /__  
    /_____/\____/_/\__,_/_/ /_/  /___/_/ /_/_/  \____/____/\___/\___/  


            Smb Server Setup
            Made By : Kyand
    -----------------------------------------------------------------------
        """)
    smbServer = SmbServer()
